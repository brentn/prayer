@use '@angular/material' as mat;
@use 'sass:color';

// Define base theme colors using SCSS variables for derivation
$theme-primary: #543121;
$theme-secondary: #7e5831;
$theme-accent: #943801;
$theme-surface: #23140f;

// Define base theme colors at the top
:root {
    // Default (dark brown) theme base colors
    --theme-primary: #{$theme-primary};
    --theme-secondary: #{$theme-secondary};
    --theme-accent: #{$theme-accent};
    --theme-surface: #{$theme-surface};
}

// Derive all other colors from base theme colors
:root {
    // Material Design system colors
    --md-sys-color-surface: #{$theme-surface};
    --md-sys-color-on-surface: #f7f3ef;
    --md-sys-color-primary: #{$theme-primary};
    --md-sys-color-on-primary: #fffaf6;
    --md-sys-color-primary-container: #{$theme-accent};
    --md-sys-color-on-primary-container: #{$theme-secondary};
    --md-sys-color-tertiary: #{$theme-primary};
    --md-sys-color-on-tertiary: #{$theme-secondary};
    --app-color-primary-darker: #{$theme-secondary};

    // Prayer session colors derived from theme
    --prayer-bg-gradient-start: #{color.adjust($theme-surface, $lightness: -10%)};
    --prayer-bg-gradient-middle: #{color.mix($theme-surface, $theme-primary, 70%)};
    --prayer-bg-gradient-end: #{color.adjust($theme-surface, $lightness: -10%)};
    --prayer-text-primary: rgba(255, 245, 235, 0.95);
    --prayer-text-secondary: rgba(255, 255, 255, 0.85);
    --prayer-text-muted: rgba(255, 255, 255, 0.75);
    --prayer-card-bg: rgba(255, 255, 255, 0.07);
    --prayer-card-border: #{color.adjust($theme-primary, $alpha: 0.12)};
    --prayer-card-shadow: #{color.adjust($theme-secondary, $alpha: 0.45)};
    --prayer-overlay-bg: rgba(0, 0, 0, 0.22);
    --prayer-overlay-border: #{color.adjust($theme-primary, $alpha: 0.08)};
    --prayer-footer-bg: #{color.adjust($theme-secondary, $alpha: 0.85)};
    --prayer-footer-border: #{color.adjust($theme-primary, $alpha: 0.08)};
    --prayer-session-list-bg: rgba(0, 0, 0, 0.18);
    --prayer-session-list-border: #{color.adjust($theme-primary, $alpha: 0.1)};
    --prayer-session-list-separator: #{color.adjust($theme-primary, $alpha: 0.08)};

    // Slider colors derived from theme
    --slider-active-track: rgba(255, 255, 255, 0.95);
    --slider-inactive-track: rgba(255, 255, 255, 0.32);
    --slider-handle: #{$theme-accent};
}

// Answered prayer cards - fixed color scheme independent of theme
:root {
    --answered-bg-gradient: linear-gradient(135deg, #0a0a0a, #1a1a1a, #0f0f0f, #2a2a2a, #0a0a0a);
    --answered-border: #555555;
    --answered-shadow: rgba(192, 192, 192, 0.4);
    --answered-text-primary: #ffffff;
    --answered-text-secondary: #e0e0e0;
    --answered-accent: #E8E8E8;
}

// Dark brown theme using Material Design 3 theming API with CSS variables
$darkTheme: mat.define-theme((color: (theme-type: dark,
                use-system-variables: true,
            ),
        ));

$lightTheme: mat.define-theme((color: (theme-type: light,
                use-system-variables: true,
            ),
        ));

$mintyTheme: mat.define-theme((color: (theme-type: light,
                use-system-variables: true,
            ),
        ));

$cozyTheme: mat.define-theme((color: (theme-type: dark,
                use-system-variables: true,
            ),
        ));

@include mat.core();
@include mat.all-component-themes($darkTheme);

// Apply light theme when body has light-theme class
.light-theme {
    @include mat.all-component-themes($lightTheme);
}

// Apply minty theme when body has minty-theme class
.minty-theme {
    @include mat.all-component-themes($mintyTheme);
}

// Apply cozy theme when body has cozy-theme class
.cozy-theme {
    @include mat.all-component-themes($cozyTheme);
}

// Light theme base colors and derivations
.light-theme {
    $theme-primary: #42a5f5;
    $theme-secondary: #e3f2fd;
    $theme-accent: #1e88e5;
    $theme-surface: #fafafa;

    --theme-primary: #{$theme-primary};
    --theme-secondary: #{$theme-secondary};
    --theme-accent: #{$theme-accent};
    --theme-surface: #{$theme-surface};

    --md-sys-color-surface: #{$theme-surface};
    --md-sys-color-on-surface: #{color.adjust($theme-primary, $lightness: -40%)};
    --md-sys-color-primary: #{$theme-primary};
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #{$theme-accent};
    --md-sys-color-on-primary-container: #ffffff;
    --md-sys-color-tertiary: #{$theme-primary};
    --md-sys-color-on-tertiary: #{color.adjust($theme-primary, $lightness: -40%)};
    --app-color-primary-darker: #{$theme-primary};

    --prayer-bg-gradient-start: #{color.mix($theme-secondary, $theme-primary, 50%)};
    --prayer-bg-gradient-middle: #{color.adjust($theme-secondary, $lightness: 5%)};
    --prayer-bg-gradient-end: #{color.mix($theme-secondary, $theme-primary, 50%)};
    --prayer-text-primary: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.95)};
    --prayer-text-secondary: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.85)};
    --prayer-text-muted: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.75)};
    --prayer-card-bg: rgba(255, 255, 255, 0.9);
    --prayer-card-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-card-shadow: #{color.adjust($theme-primary, $alpha: 0.2)};
    --prayer-overlay-bg: rgba(255, 255, 255, 0.8);
    --prayer-overlay-border: #{color.adjust($theme-primary, $alpha: 0.2)};
    --prayer-footer-bg: rgba(255, 255, 255, 0.95);
    --prayer-footer-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-bg: rgba(255, 255, 255, 0.7);
    --prayer-session-list-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-separator: #{color.adjust($theme-primary, $alpha: 0.2)};

    --slider-active-track: #{color.adjust($theme-primary, $alpha: 0.9)};
    --slider-inactive-track: #{color.adjust($theme-primary, $alpha: 0.4)};
    --slider-handle: #{color.adjust($theme-accent, $lightness: -10%)};
}

.minty-theme {
    $theme-primary: #4caf50;
    $theme-secondary: #e8f5e8;
    $theme-accent: #66bb6a;
    $theme-surface: #f1f8e9;

    --theme-primary: #{$theme-primary};
    --theme-secondary: #{$theme-secondary};
    --theme-accent: #{$theme-accent};
    --theme-surface: #{$theme-surface};

    --md-sys-color-surface: #{$theme-surface};
    --md-sys-color-on-surface: #{color.adjust($theme-primary, $lightness: -40%)};
    --md-sys-color-primary: #{$theme-primary};
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #{$theme-accent};
    --md-sys-color-on-primary-container: #ffffff;
    --md-sys-color-tertiary: #{$theme-primary};
    --md-sys-color-on-tertiary: #{color.adjust($theme-primary, $lightness: -40%)};
    --app-color-primary-darker: #{$theme-primary};

    --prayer-bg-gradient-start: #{color.mix($theme-secondary, $theme-primary, 50%)};
    --prayer-bg-gradient-middle: #{color.adjust($theme-secondary, $lightness: 5%)};
    --prayer-bg-gradient-end: #{color.mix($theme-secondary, $theme-primary, 50%)};
    --prayer-text-primary: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.95)};
    --prayer-text-secondary: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.85)};
    --prayer-text-muted: #{color.adjust(color.adjust($theme-primary, $lightness: -40%), $alpha: 0.75)};
    --prayer-card-bg: rgba(255, 255, 255, 0.95);
    --prayer-card-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-card-shadow: #{color.adjust($theme-primary, $alpha: 0.2)};
    --prayer-overlay-bg: rgba(255, 255, 255, 0.85);
    --prayer-overlay-border: #{color.adjust($theme-primary, $alpha: 0.25)};
    --prayer-footer-bg: rgba(255, 255, 255, 0.95);
    --prayer-footer-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-bg: rgba(255, 255, 255, 0.8);
    --prayer-session-list-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-separator: #{color.adjust($theme-primary, $alpha: 0.2)};

    --slider-active-track: #{color.adjust($theme-primary, $alpha: 0.9)};
    --slider-inactive-track: #{color.adjust($theme-primary, $alpha: 0.4)};
    --slider-handle: #{color.adjust($theme-accent, $lightness: -10%)};
}

.cozy-theme {
    $theme-primary: #9c27b0;
    $theme-secondary: #1a1a1a;
    $theme-accent: #e91e63;
    $theme-surface: #121212;

    --theme-primary: #{$theme-primary};
    --theme-secondary: #{$theme-secondary};
    --theme-accent: #{$theme-accent};
    --theme-surface: #{$theme-surface};

    --md-sys-color-surface: #{$theme-surface};
    --md-sys-color-on-surface: #f8f8f8;
    --md-sys-color-primary: #{$theme-primary};
    --md-sys-color-on-primary: #ffffff;
    --md-sys-color-primary-container: #{$theme-accent};
    --md-sys-color-on-primary-container: #ffffff;
    --md-sys-color-tertiary: #{$theme-primary};
    --md-sys-color-on-tertiary: #f8f8f8;
    --app-color-primary-darker: #{$theme-secondary};

    --prayer-bg-gradient-start: #{color.mix($theme-secondary, $theme-primary, 20%)};
    --prayer-bg-gradient-middle: #{color.adjust($theme-secondary, $lightness: 10%)};
    --prayer-bg-gradient-end: #{color.mix($theme-secondary, $theme-primary, 20%)};
    --prayer-text-primary: rgba(248, 248, 248, 0.95);
    --prayer-text-secondary: rgba(248, 248, 248, 0.85);
    --prayer-text-muted: rgba(248, 248, 248, 0.75);
    --prayer-card-bg: rgba(255, 255, 255, 0.05);
    --prayer-card-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-card-shadow: #{color.adjust($theme-primary, $alpha: 0.2)};
    --prayer-overlay-bg: rgba(0, 0, 0, 0.3);
    --prayer-overlay-border: #{color.adjust($theme-primary, $alpha: 0.25)};
    --prayer-footer-bg: #{color.adjust($theme-surface, $alpha: 0.9)};
    --prayer-footer-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-bg: rgba(0, 0, 0, 0.25);
    --prayer-session-list-border: #{color.adjust($theme-primary, $alpha: 0.3)};
    --prayer-session-list-separator: #{color.adjust($theme-primary, $alpha: 0.2)};

    --slider-active-track: #{color.adjust($theme-primary, $alpha: 0.9)};
    --slider-inactive-track: #{color.adjust($theme-primary, $alpha: 0.4)};
    --slider-handle: #{color.adjust($theme-accent, $lightness: -10%)};
}

html,
body {
    height: 100%;
}

body {
    margin: 0;
    background: var(--md-sys-color-surface);
    color: var(--md-sys-color-on-surface);
    font-family: "Roboto Flex", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 1.25rem;
}

/* Solid background for Material menus (fix transparent look on dark theme) */
/* The menu surface classes are on the same element as mat-mdc-menu-panel */
.mat-mdc-menu-panel,
.mat-mdc-menu-panel.mdc-menu-surface {
    background-color: var(--md-sys-color-primary) !important;
    color: var(--md-sys-color-on-primary) !important;
    border: 1px solid rgba(255, 255, 255, 0.2) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3), 0 2px 6px rgba(62, 39, 35, 0.4) !important;
}

.mat-mdc-menu-item .mat-mdc-menu-item-text,
.mat-mdc-menu-item .mat-icon {
    color: var(--md-sys-color-on-primary) !important;
}

/* Light theme menu styles */
.light-theme .mat-mdc-menu-panel,
.light-theme .mat-mdc-menu-panel.mdc-menu-surface {
    background-color: var(--md-sys-color-surface) !important;
    color: var(--md-sys-color-on-surface) !important;
    border: 1px solid rgba(0, 0, 0, 0.2) !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1), 0 2px 6px rgba(66, 165, 245, 0.2) !important;
}

.light-theme .mat-mdc-menu-item .mat-mdc-menu-item-text,
.light-theme .mat-mdc-menu-item .mat-icon {
    color: var(--md-sys-color-on-surface) !important;
}