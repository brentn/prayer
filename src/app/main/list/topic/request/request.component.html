@if (isEditing) {
    <div class="request-card editing">
        @if (requestState === 'open') {
            <button class="priority-badge" [ngClass]="'priority-' + editingPriority()" (click)="onCyclePriority()"
                [disabled]="!editingText.trim()">
                {{ editingPriority() }}
            </button>
        } @else if (editingPriority() > 1) {
            <div class="priority-dot-static" [ngClass]="'priority-' + editingPriority()"></div>
        }
        <textarea class="edit-textarea" rows="3" [value]="editingText" (input)="editingText = $any($event.target).value"
            [placeholder]="requestState === 'open' ? 'Type your request...' : 'Update your request...'"
            autofocus></textarea>
        <div class="inline-actions">
            <div class="left">
                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="More options">
                    <mat-icon>more_vert</mat-icon>
                </button>
                <mat-menu #menu="matMenu">
                    @if (requestState === 'open') {
                        <button mat-menu-item (click)="onMarkAnswered()" [disabled]="!editingText.trim()">
                            <mat-icon>check</mat-icon>
                            <span>Mark as Answered</span>
                        </button>
                        <button mat-menu-item (click)="onArchive()" [disabled]="!editingText.trim()">
                            <mat-icon>archive</mat-icon>
                            <span>Archive</span>
                        </button>
                    } @else if (requestState === 'answered') {
                        <button mat-menu-item (click)="onMarkUnanswered()" [disabled]="!editingText.trim()">
                            <mat-icon>undo</mat-icon>
                            <span>Mark as Unanswered</span>
                        </button>
                        <button mat-menu-item (click)="onArchive()" [disabled]="!editingText.trim()">
                            <mat-icon>archive</mat-icon>
                            <span>Archive</span>
                        </button>
                    } @else if (requestState === 'archived') {
                        <button mat-menu-item (click)="onUnarchive()" [disabled]="!editingText.trim()">
                            <mat-icon>unarchive</mat-icon>
                            <span>Unarchive</span>
                        </button>
                    }
                </mat-menu>
            </div>
            <div class="right">
                <button mat-button (click)="onCancel()">Cancel</button>
                <button mat-flat-button color="primary" [disabled]="!editingText.trim()" (click)="onSave()">
                    Save
                </button>
            </div>
        </div>
    </div>
} @else {
    <div class="request-card" (click)="onEdit()">
        @if (request.priority && request.priority > 1) {
            @if (requestState === 'open') {
                <div class="priority-dot-static" [ngClass]="'priority-' + request.priority"></div>
            } @else {
                <div class="priority-dot-static" [ngClass]="'priority-' + request.priority"></div>
            }
        }
        <div class="request-header">
            @if (request.priority && request.priority > 1) {
                <div class="priority-dot" [class]="'priority-' + request.priority"></div>
            }
        </div>
        <div class="request-text">{{ request.description }}</div>
        <div class="request-date">{{ request.createdDate | date:'short' }}</div>
    </div>
}