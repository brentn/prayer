<div class="card" [class.answered]="isAnswered || localIsAnswered()">
    <app-prayer-card-header [priority]="priority" [isAnswered]="isAnswered" [localIsAnswered]="localIsAnswered()"
        [prayerCount]="prayerCount" [createdDate]="createdDate" [answeredDate]="answeredDate"
        [answeredSummary]="answeredSummary()" [answeredDateText]="answeredDateText()"
        [showAnswerForm]="showAnswerForm()" [isTopic]="!topicName" [onAnsweredClick]="onAnsweredClick.bind(this)">
    </app-prayer-card-header>
    <app-prayer-card-content [icon]="icon" [title]="localTitleEdited() ? localTitle() : title" [topicName]="topicName"
        [isAnswered]="isAnswered" [localIsAnswered]="localIsAnswered()" [answerDescription]="answerDescription"
        [localAnswerDescription]="localAnswerDescription()" [onAnsweredClick]="onAnsweredClick.bind(this)"
        [showAnswerForm]="showAnswerForm()" [isTopic]="!topicName" (archive)="archive.emit()"
        (editTitle)="onTitleEdited($event)">
    </app-prayer-card-content>
    <app-answer-form [showAnswerForm]="showAnswerForm" [answerText]="answerText" [dialogOpen]="answerDialogOpen()"
        [onAnswerSubmit]="onAnswerSubmit.bind(this)" [onAnswerCancel]="onAnswerCancel.bind(this)"
        (openAnswerDialog)="openAnswerDialog()">
    </app-answer-form>
    @if (listName || (!isAnswered && !localIsAnswered())) {
        <div class="card-footer">
            <span *ngIf="listName">{{ listName}}</span>
            <div *ngIf="!isAnswered && !localIsAnswered()" class="new-request-button">
                <button mat-icon-button (click)="onNewRequest()">
                    <mat-icon>add</mat-icon>
                </button>
            </div>
        </div>
    }
    @if (showDialog()) {
        <div class="dialog-overlay" (click)="closeDialog()">
            <div class="dialog-content" (click)="$event.stopPropagation()">
                <div class="dialog-header">
                    <h2>New Prayer Request</h2>
                </div>
                <p>Topic: {{ topicName || title }}</p>
                <textarea [(ngModel)]="newRequestText" placeholder="Enter your prayer request..." rows="4"
                    style="width: 100%;"></textarea>
                <div class="dialog-actions">
                    <button mat-button style="color: grey;" (click)="closeDialog()">Cancel</button>
                    <button mat-flat-button style="background-color: var(--app-accent-color); color: white;"
                        (click)="onSave()">Save</button>
                </div>
            </div>
        </div>
    }
    <div [style.display]="showAnswerDialog() ? 'block' : 'none'" class="dialog-overlay" (click)="closeAnswerDialog()">
        <div class="dialog-content" (click)="$event.stopPropagation()">
            <div class="dialog-header">
                <h2>Add Answer</h2>
            </div>
            <p>Request: {{ title }}</p>
            <textarea [(ngModel)]="answerDialogText" placeholder="Describe the answer..." rows="4"
                style="width: 100%;"></textarea>
            <div class="dialog-actions">
                <button mat-button style="color: grey;" (click)="closeAnswerDialog()">Cancel</button>
                <button mat-flat-button style="background-color: var(--app-accent-color); color: white;"
                    (click)="onSaveAnswer()">{{ answerDialogText().trim() ? 'Save' : 'Skip' }}</button>
            </div>
        </div>
    </div>
</div>