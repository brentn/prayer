<div class="card-content">
    <mat-icon class="card-icon">{{ icon }}</mat-icon>
    @if (topicName) {
        <div class="card-topic">{{topicName}}:</div>
    }


    <!-- Request mode: show actions for single request -->
    @if (!(isAnswered || localIsAnswered) && !showAnswerForm && !isTopic) {
        <div class="button-row">
            <button mat-button class="archive-button" (click)="archive.emit()" title="Archive Request">
                completed
            </button>
            <button mat-button class="answer-button" (click)="onAnsweredClick?.()" title="Mark as Answered">
                answered
            </button>
        </div>
    }
    @if ((isAnswered || localIsAnswered) && (answerDescription || localAnswerDescription)) {
        <div class="answer-description-box" [@answerFadeIn]>
            {{ answerDescription || localAnswerDescription }}
        </div>
    }

    <!-- Topic mode: list active requests with actions -->
    @if (isTopic) {
        <div class="topic-requests">
            <ul class="request-list">
                @for (req of openRequests(); track req.id) {
                    <li class="request-row" (click)="toggleRequestActions(req.id, $event)"
                        [class.active]="activeRequestId === req.id">
                        <div class="row-head">
                            <mat-icon class="chevron"
                                [class.rotated]="activeRequestId === req.id">chevron_right</mat-icon>
                            <div class="request-text">{{ req.description }}</div>
                        </div>
                        @if (activeRequestId === req.id) {
                            <div class="request-actions">
                                <button mat-button class="archive-button"
                                    (click)="$event.stopPropagation(); archiveRequest(req.id)" title="Archive Request">
                                    completed
                                </button>
                                <button mat-button class="answer-button"
                                    (click)="$event.stopPropagation(); markAnswered(req.id)" title="Mark as Answered">
                                    answered
                                </button>
                            </div>
                        }
                    </li>
                }
            </ul>
            <!-- No empty-state message needed for topics without active requests -->
        </div>
    }
</div>