import{a as G,b as J}from"./chunk-D5UZXCWY.js";import{a as w,b as F,c as O,d as D,e as V,f as A}from"./chunk-OS5DXOMC.js";import{c as z}from"./chunk-5L3NEEFY.js";import{a as K}from"./chunk-N3BUTQJV.js";import{c as E,e as R,h as $,i as B}from"./chunk-BTN7GLWV.js";import{n as H}from"./chunk-SHVGM3UO.js";import{Y as j,i as k}from"./chunk-W4MHS7CD.js";import{Fb as C,Gb as h,Ib as T,Jb as N,Lb as m,Mb as a,Xb as f,a as S,ab as l,b as P,hc as L,jc as c,kc as y,la as u,rb as q,xc as I}from"./chunk-H2AXNUGV.js";var Y=(i,r)=>r.kind+"-"+r.id;function Z(i,r){i&1&&(m(0,"div",3),c(1,"No requests yet."),a())}function tt(i,r){if(i&1&&(m(0,"div",8),c(1),a()),i&2){let n=f(2).$implicit;l(),y(n.topicName)}}function et(i,r){if(i&1&&(m(0,"a",4)(1,"mat-icon",6),c(2,"favorite"),a(),m(3,"div",7),c(4),a(),C(5,tt,2,1,"div",8),a()),i&2){let n=f().$implicit;l(4),y(n.description),l(),h(n.topicName?5:-1)}}function it(i,r){if(i&1&&(m(0,"a",5)(1,"mat-icon",6),c(2,"label"),a(),m(3,"div",7),c(4),a(),m(5,"div",8),c(6,"Topic (no requests)"),a()()),i&2){let n=f().$implicit;l(4),y(n.name)}}function nt(i,r){if(i&1&&C(0,et,6,2,"a",4)(1,it,7,1,"a",5),i&2){let n=r.$implicit;h(n.kind==="request"?0:1)}}function ot(i,r){if(i&1&&T(0,nt,2,1,null,null,Y),i&2){let n=f();N(n.items())}}var Q=class i{store=u(H);route=u(E);router=u(R);settings=u(K);listId;fullScreen=!1;lists=this.store.selectSignal(z);topics=this.store.selectSignal(J);requests=this.store.selectSignal(G);listIdFromRoute=I(()=>Number(this.route.snapshot.paramMap.get("listId"))||void 0);effectiveListId=I(()=>this.listId??this.listIdFromRoute());items=I(()=>{let r=this.effectiveListId(),n=this.topics(),p=this.requests(),U=this.settings.shuffleRequests(),v;r&&(v=this.lists().find(s=>s.id===r)?.topicIds||[]);let W=new Set(v??n.map(t=>t.id)),g=n.filter(t=>W.has(t.id)),x=new Set,b=p.map(t=>P(S({},t),{priority:t.priority??1})).filter(t=>{if(x.has(t.id))return!0;let s=g.some(o=>(o.requestIds||[]).includes(t.id));return s&&x.add(t.id),s}),M=g.filter(t=>(t.requestIds||[]).length===0);if(U){let t=[];for(let e of b){let d=g.find(_=>(_.requestIds||[]).includes(e.id)),X=Math.max(1,Number(e.priority)||1);for(let _=0;_<X;_++)t.push({kind:"request",id:e.id,description:e.description,topicName:d?.name,priority:e.priority,prayerCount:e.prayerCount})}for(let e of M)t.push({kind:"topic",id:e.id,name:e.name});for(let e=t.length-1;e>0;e--){let d=Math.floor(Math.random()*(e+1));[t[e],t[d]]=[t[d],t[e]]}let s=new Set,o=[];for(let e of t){if(e.kind==="topic"){o.push(e);continue}s.has(e.id)||(s.add(e.id),o.push(e))}return o}else{let t=b.map(o=>({r:o,score:(Number(o.priority)||1)*10-(Number(o.prayerCount)||0)}));t.sort((o,e)=>e.score-o.score);let s=[];for(let{r:o}of t){let e=g.find(d=>(d.requestIds||[]).includes(o.id));s.push({kind:"request",id:o.id,description:o.description,topicName:e?.name,priority:o.priority,prayerCount:o.prayerCount})}for(let o of M)s.push({kind:"topic",id:o.id,name:o.name});return s}});back(){this.router.navigate(["/"])}static \u0275fac=function(n){return new(n||i)};static \u0275cmp=q({type:i,selectors:[["app-pray"]],hostVars:2,hostBindings:function(n,p){n&2&&L("fullscreen",p.fullScreen)},inputs:{listId:"listId",fullScreen:"fullScreen"},decls:7,vars:1,consts:[[1,"section-bar"],[1,"section-title"],[1,"list"],[1,"empty"],["mat-list-item",""],["mat-list-item","",1,"topic-item"],["matListItemIcon",""],["matListItemTitle",""],["matListItemLine","",1,"sub"]],template:function(n,p){n&1&&(m(0,"section")(1,"div",0)(2,"h3",1),c(3,"Pray"),a()(),m(4,"mat-nav-list",2),C(5,Z,2,0,"div",3)(6,ot,2,0),a()()),n&2&&(l(5),h(p.items().length===0?5:6))},dependencies:[k,A,V,D,O,F,w,B,$,j],styles:["section[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 6rem);margin:1rem;border:1px solid rgba(255,255,255,.2);border-radius:12px}.section-bar[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem;margin-bottom:.5rem}.section-title[_ngcontent-%COMP%]{margin:0;color:var(--md-sys-color-on-primary);background-color:var(--app-color-primary-darker);text-align:center;font-weight:400;flex-grow:1;padding:.75rem;border:1px solid rgba(255,255,255,.2);border-top-left-radius:12px;border-top-right-radius:12px}.list[_ngcontent-%COMP%]{padding:.5rem}.sub[_ngcontent-%COMP%]{opacity:.7}.topic-item[_ngcontent-%COMP%]{opacity:.8}.fullscreen[_nghost-%COMP%]   section[_ngcontent-%COMP%]{height:100vh;margin:0;border:none;border-radius:0}"]})};export{Q as a};
