import{a as q}from"./chunk-XDIOSWOQ.js";import{a as $}from"./chunk-FPTE72VE.js";import{a as J}from"./chunk-OK4YZLQP.js";import{a as W,b as G}from"./chunk-7RDUCQRV.js";import{e as H,f as A,g as B}from"./chunk-PSIEUZGJ.js";import{e as k,g as R,l as U}from"./chunk-OFSL7WP5.js";import{n as z}from"./chunk-CUIRS57P.js";import"./chunk-OFLITA35.js";import{B as V,q as X,s as F,t as Y,w as j}from"./chunk-G4EI2RDK.js";import{e as N,i as O}from"./chunk-3LJD7IJG.js";import{$a as x,Ab as a,Ea as b,Fb as D,Jb as p,Kb as L,Ub as I,Wa as f,Yb as c,Zb as T,_b as E,d as m,eb as M,fb as _,hc as g,ka as l,kb as C,mb as P,qa as v,qb as y,ra as w,yb as S,zb as r}from"./chunk-YWQZOCZU.js";var u=class o{constructor(t,e){this.el=t;this.rd=e}swipeLeft=new x;startX=0;startY=0;dragging=!1;didSwipe=!1;maxReveal=96;threshold=80;setTransform(t,e=!1){e?this.rd.setStyle(this.el.nativeElement,"transition","transform .2s ease"):this.rd.setStyle(this.el.nativeElement,"transition","none"),this.rd.setStyle(this.el.nativeElement,"transform",`translateX(${t}px)`)}reset(){this.setTransform(0,!0)}flyOutAnd(){return new Promise(t=>{let e=()=>{this.el.nativeElement.removeEventListener("transitionend",e),t()};this.el.nativeElement.addEventListener("transitionend",e),this.rd.setStyle(this.el.nativeElement,"transition","transform .25s ease"),this.rd.setStyle(this.el.nativeElement,"transform","translateX(-120%)")})}onDown(t){this.dragging=!0,this.startX=t.clientX,this.startY=t.clientY,this.didSwipe=!1,this.setTransform(0,!1)}onMove(t){if(!this.dragging)return;let e=t.clientX-this.startX;if(Math.abs(t.clientY-this.startY)>Math.abs(e))return;let n=Math.min(0,Math.max(-this.maxReveal,e));this.setTransform(n,!1)}onUp(t){if(!this.dragging)return;let e=t.clientX-this.startX,i=Math.abs(t.clientY-this.startY);this.dragging=!1,-e>this.threshold&&i<40?(this.didSwipe=!0,t.preventDefault(),t.stopImmediatePropagation(),this.swipeLeft.emit()):this.reset()}onCancel(){this.dragging=!1,this.reset()}onClick(t){this.didSwipe&&(t.preventDefault(),t.stopImmediatePropagation(),this.didSwipe=!1)}static \u0275fac=function(e){return new(e||o)(_(b),_(M))};static \u0275dir=P({type:o,selectors:[["","appSwipeLeft",""]],hostBindings:function(e,i){e&1&&p("pointerdown",function(s){return i.onDown(s)})("pointermove",function(s){return i.onMove(s)})("pointerup",function(s){return i.onUp(s)})("pointercancel",function(){return i.onCancel()})("click",function(s){return i.onClick(s)})},outputs:{swipeLeft:"swipeLeft"},exportAs:["appSwipeLeft"]})};function tt(o,t){if(o&1){let e=D();r(0,"div",8)(1,"div",9)(2,"mat-icon"),c(3,"delete"),a()(),r(4,"div",10,0),p("swipeLeft",function(){let n=v(e).$implicit,s=I(5),d=L();return w(d.onSwipeLeft(n.id,s))})("click",function(){let n=v(e).$implicit,s=L();return w(s.openTopic(n.id))}),r(6,"div",11),c(7),a()()()}if(o&2){let e=t.$implicit;f(7),T(e.name)}}var K=class o{store=l(z);dialog=l(j);route=l(k);router=l(R);swipeNav=l($);allTopics=this.store.selectSignal(J);lists=this.store.selectSignal(U);isLast=g(()=>{let t=this.lists(),e=t.findIndex(i=>i.id===this.listId);return e>=0&&e===t.length-1});listId=Number(this.route.snapshot.paramMap.get("id"))||void 0;currentList=g(()=>this.lists().find(t=>t.id===this.listId));topics=g(()=>{let t=this.currentList();if(!t)return[];let e=new Set(t.topicIds);return this.allTopics().filter(i=>e.has(i.id))});onAdd(){return m(this,null,function*(){let{AddNameDialogComponent:t}=yield import("./chunk-JT6A2M36.js");this.dialog.open(t,{data:{title:"New Topic",label:"Topic name",placeholder:"e.g., Health"}}).afterClosed().subscribe(i=>m(this,null,function*(){if(!i)return;let n=this.allTopics(),s=n.length?Math.max(...n.map(h=>h.id))+1:1;this.store.dispatch(W({id:s,name:i}));let d=this.currentList();if(d){let h=Array.from(new Set([...d.topicIds||[],s])),{updateList:Q}=yield import("./chunk-CY56UGPL.js");this.store.dispatch(Q({id:d.id,changes:{topicIds:h}}))}}))})}onRemove(t){return m(this,null,function*(){this.store.dispatch(G({id:t}));let e=this.currentList();if(e){let i=(e.topicIds||[]).filter(s=>s!==t),{updateList:n}=yield import("./chunk-CY56UGPL.js");this.store.dispatch(n({id:e.id,changes:{topicIds:i}}))}})}back(){this.router.navigate(["/"])}openTopic(t){this.router.navigate(["/topic",t])}onSwipeLeft(t,e){import("./chunk-26VG3FCG.js").then(i=>{this.dialog.open(i.ConfirmDialogComponent,{data:{title:"Delete topic?",message:"Are you sure you want to delete this topic?"}}).afterClosed().subscribe(n=>m(this,null,function*(){n?(yield e.flyOutAnd(),yield this.onRemove(t)):e.reset()}))})}onPagePageSwipeLeft(){let t=this.lists();if(!t.length||this.listId===void 0)return;let e=t.findIndex(n=>n.id===this.listId);if(e<0||e===t.length-1)return;let i=t[e+1].id;this.swipeNav.setDirection("left"),this.swipeNav.queueNavigation(["/list",i]),this.swipeNav.beginTransition(),this.swipeNav.setProgress(-1)}onPagePageSwipeRight(){let t=this.lists();if(!t.length||this.listId===void 0)return;let e=t.findIndex(n=>n.id===this.listId);if(e<=0){this.swipeNav.setDirection("right"),this.swipeNav.queueNavigation(["/lists"]),this.swipeNav.beginTransition(),this.swipeNav.setProgress(1);return}let i=t[e-1].id;this.swipeNav.setDirection("right"),this.swipeNav.queueNavigation(["/list",i]),this.swipeNav.beginTransition(),this.swipeNav.setProgress(1)}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=C({type:o,selectors:[["ng-component"]],decls:13,vars:4,consts:[["swipe","appSwipeLeft"],["appSwipePage","",3,"pageSwipeLeft","pageSwipeRight","canSwipeLeft","canSwipeRight"],[1,"section-bar"],["mat-icon-button","","aria-label","Back",3,"click"],[1,"section-title"],[1,"cards"],["class","swipe-wrap",4,"ngFor","ngForOf"],["mat-fab","","color","primary","aria-label","Add Topic",1,"fab","mat-mdc-extended-fab",3,"click"],[1,"swipe-wrap"],["aria-hidden","true",1,"reveal","delete"],["appSwipeLeft","","role","button","tabindex","0",1,"card",3,"swipeLeft","click"],[1,"card-title"]],template:function(e,i){if(e&1&&(r(0,"section",1),p("pageSwipeLeft",function(){return i.onPagePageSwipeLeft()})("pageSwipeRight",function(){return i.onPagePageSwipeRight()}),r(1,"div",2)(2,"button",3),p("click",function(){return i.back()}),r(3,"mat-icon"),c(4,"arrow_back"),a()(),r(5,"h3",4),c(6),a()(),r(7,"div",5),y(8,tt,8,1,"div",6),a(),r(9,"button",7),p("click",function(){return i.onAdd()}),r(10,"mat-icon"),c(11,"add"),a(),c(12," Add Topic "),a()()),e&2){let n;S("canSwipeLeft",!i.isLast())("canSwipeRight",!0),f(6),E(" ",((n=i.currentList())==null?null:n.name)||"Topics"," "),f(2),S("ngForOf",i.topics())}},dependencies:[O,N,H,B,A,Y,X,F,V,u,q],styles:["section[_ngcontent-%COMP%]{position:relative;min-height:60vh}.section-bar[_ngcontent-%COMP%]{display:flex!important;align-items:center;vertical-align:middle;gap:1rem;margin-bottom:8px}.section-title[_ngcontent-%COMP%]{color:var(--md-sys-color-on-surface, #4e342e);margin:0;align-self:center}.fab[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;z-index:100}button[_ngcontent-%COMP%]{padding:.4rem .6rem}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;gap:12px}@media (min-width: 600px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 960px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.card[_ngcontent-%COMP%]{border:1px solid rgba(78,52,46,.25);border-radius:12px;padding:12px 14px;display:flex;align-items:center;justify-content:space-between;background:#fff8f0;cursor:pointer;transition:box-shadow .2s ease,transform .05s ease;touch-action:pan-y;position:relative;z-index:1}.card[_ngcontent-%COMP%]:focus, .card[_ngcontent-%COMP%]:hover{box-shadow:0 1px 4px #3e272333}.card[_ngcontent-%COMP%]:active{transform:scale(.995)}.card-title[_ngcontent-%COMP%]{font-weight:500;color:#3e2723}.swipe-wrap[_ngcontent-%COMP%]{position:relative}.reveal[_ngcontent-%COMP%]{position:absolute;inset:0 0 0 auto;width:96px;display:flex;align-items:center;justify-content:center;border-radius:0 12px 12px 0;pointer-events:none}.reveal.delete[_ngcontent-%COMP%]{background:#d32f2f;color:#fff}"]})};export{K as ListComponent};
