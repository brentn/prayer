import{b as B,c as H}from"./chunk-EOBILOHU.js";import{c as R,f as j}from"./chunk-JXVZCUEI.js";import"./chunk-2XLD2DXU.js";import{e as O,g as E,j as S,k as I,p as q}from"./chunk-G5PG6GQF.js";import"./chunk-UGE5MLSK.js";import"./chunk-7M7SESVS.js";import{b as z,d as $}from"./chunk-S6TZUHWM.js";import{n as N}from"./chunk-GT6YPDFL.js";import{c as V,h as F}from"./chunk-KYJOQOLL.js";import"./chunk-NXN2SE2J.js";import{_ as A,ca as D,j as P}from"./chunk-2HVXPMU7.js";import{Cc as k,Da as M,Hb as f,Ib as h,Lb as L,Mb as T,Nb as x,Ob as r,Pb as c,Ub as C,Yb as d,_b as s,bb as l,d as _,ma as g,mc as u,nc as b,sa as m,sb as y,ta as p}from"./chunk-BO62JUGJ.js";var J=(o,e)=>e.id;function K(o,e){if(o&1&&(r(0,"h3"),u(1),c()),o&2){let t,i=s();l(),b(((t=i.currentList())==null?null:t.name)||"Topics")}}function Q(o,e){if(o&1){let t=C();r(0,"input",9),d("click",function(n){return m(t),p(n.stopPropagation())})("input",function(n){m(t);let a=s();return p(a.editName=n.target.value)})("keydown.enter",function(){m(t);let n=s();return p(n.saveEdit())})("keydown.escape",function(){m(t);let n=s();return p(n.cancelEdit())}),c(),r(1,"mat-checkbox",10),d("change",function(n){m(t);let a=s();return p(a.editExcludeFromAll=n.checked)}),u(2," Exclude when praying for all lists? "),c()}if(o&2){let t=s();x("value",t.editName),l(),x("checked",t.editExcludeFromAll)}}function U(o,e){if(o&1){let t=C();r(0,"button",12),d("click",function(n){return m(t),s(2).onDelete(),p(n.stopPropagation())}),r(1,"mat-icon",13),u(2,"delete"),c()()}if(o&2){let t=s(2);x("disabled",t.topics().length>0)}}function X(o,e){if(o&1&&(r(0,"div",4),f(1,U,3,1,"button",11),c()),o&2){let t=s();l(),h(t.topics().length===0?1:-1)}}function Y(o,e){if(o&1&&(r(0,"div",15),u(1),c()),o&2){let t=s().$implicit,i=s();l(),b(i.getRequestCount(t.id))}}function Z(o,e){if(o&1){let t=C();r(0,"div",14),d("click",function(){let n=m(t).$implicit,a=s();return p(a.openTopic(n.id))}),r(1,"div",8),u(2),c(),f(3,Y,2,1,"div",15),c()}if(o&2){let t=e.$implicit,i=s();l(2),b(t.name),l(),h(i.getRequestCount(t.id)>0?3:-1)}}var W=class o{store=g(N);dialog=g(V);route=g(O);router=g(E);editing=!1;editName="";editExcludeFromAll=!1;listId=M(void 0);allTopics=this.store.selectSignal(j);lists=this.store.selectSignal(q);requests=this.store.selectSignal(R);currentList=k(()=>this.lists().find(e=>e.id===this.listId()));topics=k(()=>{let e=this.currentList();if(!e)return[];let t=new Set(e.topicIds);return this.allTopics().filter(i=>t.has(i.id))});ngOnInit(){this.route.paramMap.subscribe(e=>{this.listId.set(Number(e.get("id"))||void 0)})}onAdd(){return _(this,null,function*(){let{AddNameDialogComponent:e}=yield import("./chunk-YSADQ3B2.js");this.dialog.open(e,{data:{title:"New Topic",label:"Topic name",placeholder:"e.g., Health"}}).afterClosed().subscribe(i=>_(this,null,function*(){if(!i)return;let n=this.allTopics(),a=n.length?Math.max(...n.map(w=>w.id))+1:1;this.store.dispatch(z({id:a,name:i}));let v=this.currentList();if(v){let w=Array.from(new Set([...v.topicIds||[],a])),{updateList:G}=yield import("./chunk-T7DOMFIK.js");this.store.dispatch(G({id:v.id,changes:{topicIds:w}}))}}))})}onDelete(){return _(this,null,function*(){let e=this.currentList();if(!e||(this.topics()||[]).length>0)return;let{ConfirmDialogComponent:t}=yield import("./chunk-MPW4OFRQ.js");this.dialog.open(t,{data:{title:"Delete List",message:`Delete "${e.name}"? This cannot be undone.`,confirmText:"Delete",cancelText:"Cancel"}}).afterClosed().subscribe(n=>_(this,null,function*(){if(!n)return;let{removeList:a}=yield import("./chunk-T7DOMFIK.js");this.store.dispatch(a({id:e.id})),this.router.navigate(["/"])}))})}onRemove(e){return _(this,null,function*(){this.store.dispatch($({id:e}));let t=this.currentList();if(t){let i=(t.topicIds||[]).filter(a=>a!==e),{updateList:n}=yield import("./chunk-T7DOMFIK.js");this.store.dispatch(n({id:t.id,changes:{topicIds:i}}))}})}back(){this.router.navigate(["/"])}openTopic(e){this.router.navigate(["/topic",e])}startEdit(){if(this.editing)return;let e=this.currentList();this.editing=!0,this.editName=e?.name||"",this.editExcludeFromAll=e?.excludeFromAll||!1}saveEdit(){return _(this,null,function*(){let e=this.currentList();if(!e){this.editing=!1;return}let t=(this.editName||"").trim();if(t&&t!==e.name){let{updateList:i}=yield import("./chunk-T7DOMFIK.js");this.store.dispatch(i({id:e.id,changes:{name:t,excludeFromAll:this.editExcludeFromAll}}))}else if(this.editExcludeFromAll!==(e.excludeFromAll||!1)){let{updateList:i}=yield import("./chunk-T7DOMFIK.js");this.store.dispatch(i({id:e.id,changes:{excludeFromAll:this.editExcludeFromAll}}))}this.editing=!1})}cancelEdit(){this.editing=!1,this.editName="",this.editExcludeFromAll=!1}getRequestCount(e){let t=this.allTopics().find(i=>i.id===e);return t?.requestIds?.length?this.requests().filter(i=>t.requestIds.includes(i.id)&&!i.archived&&!i.answeredDate).length:0}onSectionClick(){this.editing&&this.saveEdit()}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=y({type:o,selectors:[["ng-component"]],decls:15,vars:2,consts:[[3,"click"],[1,"section-bar",3,"click"],[1,"title-stack",3,"click"],[1,"section-title"],[1,"section-menu"],[1,"cards"],["role","button","tabindex","0",1,"card"],["role","button","tabindex","0","aria-label","Add Topic",1,"card","add-card",3,"click"],[1,"card-title"],["type","text","autofocus","",1,"edit-input",3,"click","input","keydown.enter","keydown.escape","value"],[1,"exclude-checkbox",3,"change","checked"],["mat-icon-button","","color","warn","aria-label","Delete List",1,"trash-btn",3,"disabled"],["mat-icon-button","","color","warn","aria-label","Delete List",1,"trash-btn",3,"click","disabled"],[1,"trash"],["role","button","tabindex","0",1,"card",3,"click"],["title","Requests",1,"badge"]],template:function(t,i){t&1&&(r(0,"section",0),d("click",function(){return i.onSectionClick()}),r(1,"div",1),d("click",function(a){return a.stopPropagation()}),r(2,"div",2),d("click",function(){return i.startEdit()}),r(3,"div",3),f(4,K,2,1,"h3")(5,Q,3,2),c()(),f(6,X,2,1,"div",4),c(),r(7,"div",5),L(8,Z,4,2,"div",6,J),r(10,"div",7),d("click",function(){return i.onAdd()}),r(11,"div",8)(12,"mat-icon"),u(13,"add"),c(),u(14," Add Topic "),c()()()()),t&2&&(l(4),h(i.editing?5:4),l(2),h(i.editing?6:-1),l(2),T(i.topics()))},dependencies:[P,I,S,D,A,F,H,B],styles:["section[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 6rem);min-height:calc(100vh - 6rem);margin:1rem;border:1px solid rgba(255,255,255,.2);border-radius:12px;display:flex;flex-direction:column;overflow:hidden}.section-bar[_ngcontent-%COMP%]{display:flex!important;align-items:center;vertical-align:middle;gap:1rem;margin-bottom:.5rem;position:relative;flex-shrink:0}.section-title[_ngcontent-%COMP%]{margin:0;color:var(--md-sys-color-on-primary);background-color:var(--theme-primary);flex-grow:1;padding:.75rem;border:1px solid rgba(255,255,255,.2);border-top-left-radius:12px;border-top-right-radius:12px}.section-title[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;font-size:1.25rem;font-weight:400}.exclude-checkbox[_ngcontent-%COMP%]{margin-left:0;margin-right:auto}.section-menu[_ngcontent-%COMP%]{position:absolute;right:0}.title-stack[_ngcontent-%COMP%]{display:flex;flex:1}.edit-input[_ngcontent-%COMP%]{width:100%;background:transparent;border:none;outline:none;color:var(--md-sys-color-on-primary);background-color:var(--app-color-primary-darker);font:inherit;padding:0 1rem}.trash-btn[_ngcontent-%COMP%]{position:relative}.trash-btn[disabled][_ngcontent-%COMP%]   .trash[_ngcontent-%COMP%]{opacity:.4}.trash-btn[_ngcontent-%COMP%]   .ban[_ngcontent-%COMP%]{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);color:#ffffffd9;font-size:20px;pointer-events:none;z-index:1}button[_ngcontent-%COMP%]{padding:.4rem .6rem}.cards[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr;padding:.5rem .5rem 3rem;gap:1rem;flex:1;overflow-y:auto;align-items:start;grid-auto-rows:min-content}@media (min-width: 600px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(2,1fr)}}@media (min-width: 960px){.cards[_ngcontent-%COMP%]{grid-template-columns:repeat(3,1fr)}}.card[_ngcontent-%COMP%]{border:1px solid rgba(255,255,255,.2);border-radius:12px;padding:12px 14px;display:flex;align-items:center;justify-content:space-between;background:var(--md-sys-color-primary);cursor:pointer;transition:box-shadow .2s ease,transform .05s ease;touch-action:pan-y;position:relative;z-index:1;align-self:start}.card[_ngcontent-%COMP%]:focus, .card[_ngcontent-%COMP%]:hover{box-shadow:0 1px 4px #3e272333}.card[_ngcontent-%COMP%]:active{transform:scale(.995)}.card-title[_ngcontent-%COMP%]{font-weight:300;color:var(--md-sys-color-on-primary)}.card.add-card[_ngcontent-%COMP%]{opacity:.5;display:flex;align-items:center}.card.add-card[_ngcontent-%COMP%]   .card-title[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.card.add-card[_ngcontent-%COMP%]:hover, .card.add-card[_ngcontent-%COMP%]:focus{opacity:.7}.badge[_ngcontent-%COMP%]{padding:2px 8px;border-radius:999px;background:#fff3;color:var(--md-sys-color-on-primary);font-size:12px;line-height:18px}"]})};export{W as ListComponent};
