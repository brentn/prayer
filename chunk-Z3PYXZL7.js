import{a as Y,d as Z}from"./chunk-FD6M3QFY.js";import{a as Q}from"./chunk-327JEXVN.js";import{a as G,b as H,c as J,d as K}from"./chunk-63OGDVS6.js";import{c as P,e as O,h as V,i as N,m as W}from"./chunk-ZNDUYDML.js";import"./chunk-6ICJU5RU.js";import"./chunk-Q6TWIOL2.js";import{c as z,h as $}from"./chunk-FEMVN73J.js";import{a as L,c as F,d as B}from"./chunk-5XC6QZKK.js";import{g as E,h as A}from"./chunk-745RUJWA.js";import{b as U,d as X}from"./chunk-IMUBCFXG.js";import{n as j}from"./chunk-PRSFUHHW.js";import{Cb as q,Db as M,Eb as C,Fb as w,Gb as _,Hb as r,Ib as a,Nb as x,Rb as h,Tb as R,_a as d,bc as S,d as c,ec as s,fc as b,gc as D,ic as k,jc as I,ka as u,pb as y,pc as v,qa as f,ra as g}from"./chunk-F5KG7EK2.js";var T=Y.getSelectors(Z),ee=T.selectAll,ce=T.selectEntities,le=T.selectTotal;var oe=(l,e)=>e.id;function ne(l,e){l&1&&(r(0,"div",4),s(1),a()),l&2&&(d(),D("from list: ",e.name))}function re(l,e){if(l&1){let t=x();r(0,"div",12),h("click",function(){let n=f(t).$implicit,i=R();return g(i.onEditRequest(n.id))}),r(1,"div",13),s(2),a(),r(3,"div",14),s(4),k(5,"date"),a()()}if(l&2){let t=e.$implicit;d(2),b(t.description),d(2),b(I(5,2,t.createdDate,"medium"))}}var te=class l{store=u(j);dialog=u(z);route=u(P);router=u(O);allRequests=this.store.selectSignal(ee);allTopics=this.store.selectSignal(Q);allLists=this.store.selectSignal(W);topicId=Number(this.route.snapshot.paramMap.get("id"))||void 0;currentTopic=v(()=>this.allTopics().find(e=>e.id===this.topicId));currentList=v(()=>this.allLists().find(e=>(e.topicIds||[]).includes(this.topicId)));requests=v(()=>{let e=this.currentTopic();if(!e)return[];let t=new Set(e.requestIds||[]);return this.allRequests().filter(o=>t.has(o.id))});back(){let e=this.currentList();e?this.router.navigate(["/list",e.id]):this.router.navigate(["/lists"])}onAdd(){return c(this,null,function*(){let{AddNameDialogComponent:e}=yield import("./chunk-CM77PTHA.js");this.dialog.open(e,{data:{title:"New Request",label:"Request",placeholder:"Type up to a paragraph\u2026",multiline:!0}}).afterClosed().subscribe(o=>c(this,null,function*(){if(!o)return;let n=this.allRequests(),i=n.length?Math.max(...n.map(m=>m.id))+1:1;this.store.dispatch(U({id:i,description:o}));let p=this.currentTopic();if(p){let m=Array.from(new Set([...p.requestIds||[],i])),{updateTopic:ie}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(ie({id:p.id,changes:{requestIds:m}}))}}))})}onRemove(e){return c(this,null,function*(){this.store.dispatch(X({id:e}));let t=this.currentTopic();if(t){let o=(t.requestIds||[]).filter(i=>i!==e),{updateTopic:n}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(n({id:t.id,changes:{requestIds:o}}))}})}onRenameTopic(){return c(this,null,function*(){let e=this.currentTopic();if(!e)return;let{AddNameDialogComponent:t}=yield import("./chunk-CM77PTHA.js");this.dialog.open(t,{data:{title:"Rename Topic",label:"Topic name",initial:e.name}}).afterClosed().subscribe(n=>c(this,null,function*(){if(!n)return;let{updateTopic:i}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(i({id:e.id,changes:{name:n}}))}))})}onDeleteTopic(){return c(this,null,function*(){let e=this.currentTopic();if(!e||this.requests().length>0)return;let{ConfirmDialogComponent:t}=yield import("./chunk-MAEIQDBH.js");this.dialog.open(t,{data:{title:"Delete Topic",message:"Are you sure you want to delete this topic?",confirmText:"Delete"}}).afterClosed().subscribe(n=>c(this,null,function*(){if(!n)return;let{removeTopic:i}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(i({id:e.id})),this.back()}))})}onEditRequest(e){return c(this,null,function*(){let t=this.allRequests().find(i=>i.id===e);if(!t)return;let{RequestEditDialogComponent:o}=yield import("./chunk-KJ3NUNM7.js");this.dialog.open(o,{data:{id:t.id,description:t.description,answeredDate:t.answeredDate}}).afterClosed().subscribe(i=>c(this,null,function*(){if(i){if(i.action==="delete"){yield this.onRemove(e);return}if(i.action==="save"){let p={description:i.description};i.answered?p.answeredDate=new Date().toISOString():p.answeredDate=null;let{updateRequest:m}=yield import("./chunk-HH7JC2HO.js");this.store.dispatch(m({id:e,changes:p}))}}}))})}static \u0275fac=function(t){return new(t||l)};static \u0275cmp=y({type:l,selectors:[["ng-component"]],decls:29,vars:4,consts:[["topicMenu","matMenu"],[1,"section-bar"],[1,"title-stack"],[1,"section-title"],[1,"section-subtitle"],[1,"section-menu"],["mat-icon-button","","aria-label","Topic menu",3,"matMenuTriggerFor"],["mat-menu-item","",3,"click"],["mat-menu-item","",3,"click","disabled"],[1,"requests"],[1,"request-card"],["mat-fab","","color","primary","aria-label","Add Request",1,"fab","mat-mdc-extended-fab",3,"click"],[1,"request-card",3,"click"],[1,"request-text"],[1,"request-date"]],template:function(t,o){if(t&1){let n=x();r(0,"section")(1,"div",1)(2,"div",2)(3,"h3",3),s(4),a(),q(5,ne,2,1,"div",4),a(),r(6,"div",5)(7,"button",6)(8,"mat-icon"),s(9,"more_vert"),a()(),r(10,"mat-menu",null,0)(12,"button",7),h("click",function(){return f(n),g(o.onRenameTopic())}),r(13,"mat-icon"),s(14,"edit"),a(),r(15,"span"),s(16,"Edit Topic"),a()(),r(17,"button",8),h("click",function(){return f(n),g(o.onDeleteTopic())}),r(18,"mat-icon"),s(19,"delete"),a(),r(20,"span"),s(21,"Delete Topic"),a()()()()(),r(22,"div",9),C(23,re,6,5,"div",10,oe),a(),r(25,"button",11),h("click",function(){return f(n),g(o.onAdd())}),r(26,"mat-icon"),s(27,"add"),a(),s(28," Add Request "),a()()}if(t&2){let n,i,p=S(11);d(4),b(((n=o.currentTopic())==null?null:n.name)||"Topic"),d(),M((i=o.currentList())?5:-1,i),d(2),_("matMenuTriggerFor",p),d(10),_("disabled",o.requests().length>0),d(6),w(o.requests())}},dependencies:[A,N,V,B,L,F,$,K,H,G,J,E],styles:["section[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 5rem);display:flex;flex-direction:column}.section-title[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--md-sys-color-on-surface, #4e342e)}.section-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:relative;background-color:var(--app-color-primary-darker)!important;gap:12px;padding:1rem}.title-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column}.section-subtitle[_ngcontent-%COMP%]{font-size:12px;color:#ffffffb3;margin-top:-4px}.requests[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:0 1rem 5rem;flex:1 1 auto;overflow-y:auto}.request-card[_ngcontent-%COMP%]{border-radius:12px;padding:12px 14px;background:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary);box-shadow:0 1px 4px #3e272333}.request-text[_ngcontent-%COMP%]{white-space:pre-wrap;line-height:1.4}.request-date[_ngcontent-%COMP%]{margin-top:6px;font-size:12px;color:#ffffffb3}.section-menu[_ngcontent-%COMP%]{position:absolute;right:.5rem}.fab[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;z-index:100;--mdc-extended-fab-container-color: var(--md-sys-color-primary-container);--mdc-fab-container-color: var(--md-sys-color-primary-container);--mdc-extended-fab-label-text-color: var(--md-sys-color-on-primary);--mdc-fab-foreground-color: var(--md-sys-color-on-primary);--mat-fab-foreground-color: var(--md-sys-color-on-primary);background-color:var(--md-sys-color-primary-container)!important;color:var(--md-sys-color-on-primary)!important}"]})};export{te as TopicComponent};
