import{b as ee,c as te}from"./chunk-IIZM4URB.js";import{a as z,b as G,d as H,e as J,f as Q,g as U,h as $}from"./chunk-A5D4ESY7.js";import{c as Y,f as Z}from"./chunk-CSZHDTMW.js";import"./chunk-3GZJ7K3V.js";import{g as O,j as P,k as K,o as F}from"./chunk-OGCPVXBS.js";import{b as w,c as I}from"./chunk-3QGR3AWG.js";import{b as V,c as X}from"./chunk-5W5ZRRSJ.js";import{b as y,c as _}from"./chunk-3P4DYNT4.js";import{n as W}from"./chunk-ZW4QPKHP.js";import{$ as N,X as j,Z as B,j as A}from"./chunk-PHCM72SF.js";import{Nb as T,Ob as r,Pb as c,Qb as L,Yb as g,bb as q,ma as M,mc as p,sb as D}from"./chunk-7JFBNO26.js";var ie=class v{settings=M($);router=M(O);store=M(W);keepAwake(){return this.settings.keepAwake()}toggleKeepAwake(n){this.settings.setKeepAwake(!!n.checked)}shuffleRequests(){return this.settings.shuffleRequests()}toggleShuffleRequests(n){this.settings.setShuffleRequests(!!n.checked)}close(){this.router.navigate(["/"])}cleanupData(){let n=this.store.selectSignal(F)(),s=this.store.selectSignal(Z)(),a=this.store.selectSignal(Y)(),h=new Set(s.map(e=>e.id)),f=new Set(a.map(e=>e.id));n.forEach(e=>{let t=(e.topicIds||[]).filter(i=>h.has(i));t.length!==(e.topicIds||[]).length&&this.store.dispatch(I({id:e.id,changes:{topicIds:t}}))}),s.forEach(e=>{let t=(e.requestIds||[]).filter(i=>f.has(i));t.length!==(e.requestIds||[]).length&&this.store.dispatch(_({id:e.id,changes:{requestIds:t}}))});let S=new Map;n.forEach(e=>{(e.topicIds||[]).forEach(t=>{S.has(t)||S.set(t,[]),S.get(t).push(e.id)})}),S.forEach((e,t)=>{if(e.length>1){let i=s.find(o=>o.id===t);if(!i)return;for(let o=1;o<e.length;o++){let l=Math.max(...s.map(m=>m.id))+1,u={id:l,name:i.name,requestIds:[...i.requestIds||[]]};this.store.dispatch(y({id:l,name:u.name}));let d=n.find(m=>m.id===e[o]);if(d){let m=(d.topicIds||[]).map(R=>R===t?l:R);this.store.dispatch(I({id:d.id,changes:{topicIds:m}}))}}}});let b=new Map;s.forEach(e=>{(e.requestIds||[]).forEach(t=>{b.has(t)||b.set(t,[]),b.get(t).push(e.id)})}),b.forEach((e,t)=>{if(e.length>1){let i=a.find(o=>o.id===t);if(!i)return;for(let o=1;o<e.length;o++){let l=Math.max(...a.map(d=>d.id))+1;this.store.dispatch(V({id:l,description:i.description})),this.store.dispatch(X({id:l,changes:{priority:i.priority,createdDate:i.createdDate,answeredDate:i.answeredDate,answerDescription:i.answerDescription,archived:i.archived,prayerCount:i.prayerCount}}));let u=s.find(d=>d.id===e[o]);if(u){let d=(u.requestIds||[]).map(m=>m===t?l:m);this.store.dispatch(_({id:u.id,changes:{requestIds:d}}))}}}});let ne=new Set(a.map(e=>e.id)),C=new Set;s.forEach(e=>{(e.requestIds||[]).forEach(t=>C.add(t))});let E=Array.from(ne).filter(e=>!C.has(e));if(E.length>0){let e=Math.max(...s.map(i=>i.id),0)+1;this.store.dispatch(y({id:e,name:"Orphaned Requests"})),this.store.dispatch(_({id:e,changes:{requestIds:E}}));let t=n.find(i=>i.name==="Orphaned Topics");if(t){let i=[...t.topicIds||[],e];this.store.dispatch(I({id:t.id,changes:{topicIds:i}}))}else{let i=Math.max(...n.map(o=>o.id),0)+1;this.store.dispatch(w({id:i,name:"Orphaned Topics",topicIds:[e]}))}}let se=new Set(s.map(e=>e.id)),x=new Set;n.forEach(e=>{(e.topicIds||[]).forEach(t=>x.add(t))});let k=Array.from(se).filter(e=>!x.has(e));if(k.length>0){let e=n.find(t=>t.name==="Orphaned Topics");if(e){let t=[...e.topicIds||[],...k];this.store.dispatch(I({id:e.id,changes:{topicIds:t}}))}else{let t=Math.max(...n.map(i=>i.id),0)+1;this.store.dispatch(w({id:t,name:"Orphaned Topics",topicIds:k}))}}}static \u0275fac=function(s){return new(s||v)};static \u0275cmp=D({type:v,selectors:[["ng-component"]],decls:24,vars:2,consts:[[1,"settings"],[1,"settings-bar"],["mat-icon-button","","aria-label","Close Settings",1,"close-btn",3,"click"],["matListItemTitle",""],[3,"change","checked"],["mat-stroked-button","","color","accent",3,"click"]],template:function(s,a){s&1&&(r(0,"section",0)(1,"div",1)(2,"h2"),p(3,"Settings"),c(),r(4,"button",2),g("click",function(){return a.close()}),r(5,"mat-icon"),p(6,"close"),c()()(),r(7,"mat-nav-list")(8,"mat-list-item")(9,"span",3),p(10,"Keep screen awake while praying"),c(),r(11,"mat-checkbox",4),g("change",function(f){return a.toggleKeepAwake(f)}),c()(),r(12,"mat-list-item")(13,"span",3),p(14,"Shuffle prayer requests"),c(),r(15,"mat-checkbox",4),g("change",function(f){return a.toggleShuffleRequests(f)}),c()(),L(16,"mat-divider"),r(17,"mat-list-item")(18,"span",3),p(19,"Data Cleanup"),c(),r(20,"button",5),g("click",function(){return a.cleanupData()}),r(21,"mat-icon"),p(22,"cleaning_services"),c(),p(23," Cleanup "),c()()()()),s&2&&(q(11),T("checked",a.keepAwake()),q(4),T("checked",a.shuffleRequests()))},dependencies:[A,U,Q,J,z,H,te,ee,K,P,N,B,j,G],styles:[".settings[_ngcontent-%COMP%]{padding:1rem;background:#fff;color:var(--md-sys-color-on-primary-container, #3e2723);min-height:calc(100vh - 3rem)}.settings-bar[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:space-between;gap:.5rem}h2[_ngcontent-%COMP%]{margin:0;color:var(--md-sys-color-on-primary-container, #3e2723)}mat-nav-list[_ngcontent-%COMP%]{margin-top:1rem}mat-divider[_ngcontent-%COMP%]{margin-bottom:1rem}mat-list-item[_ngcontent-%COMP%]{background:#fff;border:1px solid rgba(0,0,0,.12);border-radius:7px;padding:.25rem .5rem;margin-bottom:1rem}  .mdc-list-item__content{display:flex!important;justify-content:space-between!important;align-items:center!important}  .mdc-list-item__primary-text{flex:1!important;margin-bottom:unset!important}"]})};export{ie as SettingsComponent};
