import{a as J,b as v,c as K,d as U,g as X}from"./chunk-SWFOMQOZ.js";import{a as G}from"./chunk-NXKPZVRN.js";import"./chunk-AKY6NCKP.js";import{c as D,e as A,h as F,i as N,m as W}from"./chunk-EQTONB35.js";import"./chunk-6ICJU5RU.js";import"./chunk-Q6TWIOL2.js";import{n as H}from"./chunk-PRSFUHHW.js";import{c as Q,h as j}from"./chunk-FEMVN73J.js";import{a as L,b as z,c as B,d as $}from"./chunk-5XC6QZKK.js";import{g as P,h as O}from"./chunk-745RUJWA.js";import{Cb as f,Db as x,Eb as w,Fb as k,Gb as C,Hb as a,Ib as c,Nb as g,Rb as _,Tb as r,Xb as R,Yb as M,Zb as E,_a as l,d as m,ec as u,fc as T,gc as I,ic as V,jc as S,ka as h,pb as q,pc as b,qa as d,ra as p}from"./chunk-F5KG7EK2.js";var y=U.getSelectors(X),Y=y.selectAll,_t=y.selectEntities,ft=y.selectTotal;var tt=["requestsContainer"],et=(o,e)=>e.id;function it(o,e){if(o&1&&(a(0,"h3",3),u(1),c()),o&2){let t,i=r();l(),T(((t=i.currentTopic())==null?null:t.name)||"Topic")}}function nt(o,e){if(o&1){let t=g();a(0,"input",9),_("click",function(n){return d(t),p(n.stopPropagation())})("input",function(n){d(t);let s=r();return p(s.editName=n.target.value)})("keydown.enter",function(){d(t);let n=r();return p(n.saveEdit())})("keydown.escape",function(){d(t);let n=r();return p(n.cancelEdit())}),c()}if(o&2){let t=r();C("value",t.editName)}}function ot(o,e){o&1&&(a(0,"div",5),u(1),c()),o&2&&(l(),I("from list: ",e.name))}function rt(o,e){o&1&&(a(0,"mat-icon",12),u(1,"block"),c())}function st(o,e){if(o&1){let t=g();a(0,"div",6)(1,"button",10),_("click",function(n){return d(t),r().onDeleteTopic(),p(n.stopPropagation())}),a(2,"mat-icon",11),u(3,"delete"),c(),f(4,rt,2,0,"mat-icon",12),c()()}if(o&2){let t=r();l(),C("disabled",t.requests().length>0),l(3),x(t.requests().length>0?4:-1)}}function at(o,e){if(o&1){let t=g();a(0,"div",17)(1,"button",21),_("click",function(){d(t);let n=r(2).$implicit,s=r();return p(s.markAnsweredInline(n.id))}),u(2,"Answered"),c(),a(3,"button",22),_("click",function(){d(t);let n=r(3);return p(n.onInlineDelete())}),u(4,"Delete"),c()()}if(o&2){let t=r(3);l(),C("disabled",!t.editingRequestText.trim())}}function ct(o,e){if(o&1){let t=g();a(0,"div",13)(1,"textarea",15),_("input",function(n){d(t);let s=r(2);return p(s.editingRequestText=n.target.value)})("keydown.enter",function(){d(t);let n=r().$implicit,s=r();return p(s.saveInline(n.id))}),c(),a(2,"div",16),f(3,at,5,1,"div",17),a(4,"div",18)(5,"button",19),_("click",function(){d(t);let n=r(2);return p(n.cancelInline())}),u(6,"Cancel"),c(),a(7,"button",20),_("click",function(){d(t);let n=r().$implicit,s=r();return p(s.saveInline(n.id))}),u(8,"Save"),c()()()()}if(o&2){let t=r(2);l(),C("value",t.editingRequestText),l(2),x(t.editingExisting?3:-1),l(4),C("disabled",!t.editingRequestText.trim())}}function lt(o,e){if(o&1){let t=g();a(0,"div",23),_("click",function(){d(t);let n=r().$implicit,s=r();return p(s.onEditRequest(n.id))}),a(1,"div",24),u(2),c(),a(3,"div",25),u(4),V(5,"date"),c()()}if(o&2){let t=r().$implicit;l(2),T(t.description),l(2),T(S(5,2,t.createdDate,"short"))}}function dt(o,e){if(o&1&&f(0,ct,9,3,"div",13)(1,lt,6,5,"div",14),o&2){let t=e.$implicit,i=r();x(i.editingRequestId===t.id?0:1)}}function pt(o,e){if(o&1){let t=g();a(0,"button",26),_("click",function(){d(t);let n=r();return p(n.onAdd())}),a(1,"mat-icon"),u(2,"add"),c(),u(3," Add Request "),c()}}var Z=class o{requestsContainer;store=h(H);dialog=h(Q);route=h(D);router=h(A);editing=!1;editName="";editingRequestId=null;editingRequestText="";editingExisting=!1;allRequests=this.store.selectSignal(Y);allTopics=this.store.selectSignal(G);allLists=this.store.selectSignal(W);topicId=Number(this.route.snapshot.paramMap.get("id"))||void 0;currentTopic=b(()=>this.allTopics().find(e=>e.id===this.topicId));currentList=b(()=>this.allLists().find(e=>(e.topicIds||[]).includes(this.topicId)));requests=b(()=>{let e=this.currentTopic();if(!e)return[];let t=new Set(e.requestIds||[]);return this.allRequests().filter(i=>t.has(i.id))});back(){let e=this.currentList();e?this.router.navigate(["/list",e.id]):this.router.navigate(["/lists"])}startEdit(){if(this.editing)return;let e=this.currentTopic();this.editing=!0,this.editName=e?.name||""}saveEdit(){return m(this,null,function*(){let e=this.currentTopic();if(!e){this.editing=!1;return}let t=(this.editName||"").trim();if(t&&t!==e.name){let{updateTopic:i}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(i({id:e.id,changes:{name:t}}))}this.editing=!1})}cancelEdit(){this.editing=!1,this.editName=""}onAdd(){return m(this,null,function*(){let e=this.allRequests(),t=e.length?Math.max(...e.map(n=>n.id))+1:1;this.store.dispatch(J({id:t,description:""}));let i=this.currentTopic();if(i){let n=Array.from(new Set([...i.requestIds||[],t])),{updateTopic:s}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(s({id:i.id,changes:{requestIds:n}}))}this.editingRequestId=t,this.editingRequestText="",this.editingExisting=!1,this.scrollToBottomSoon()})}onRemove(e){return m(this,null,function*(){this.store.dispatch(K({id:e}));let t=this.currentTopic();if(t){let i=(t.requestIds||[]).filter(s=>s!==e),{updateTopic:n}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(n({id:t.id,changes:{requestIds:i}}))}})}onRenameTopic(){return m(this,null,function*(){let e=this.currentTopic();if(!e)return;let{AddNameDialogComponent:t}=yield import("./chunk-ZJ7JTUJG.js");this.dialog.open(t,{data:{title:"Rename Topic",label:"Topic name",initial:e.name}}).afterClosed().subscribe(n=>m(this,null,function*(){if(!n)return;let{updateTopic:s}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(s({id:e.id,changes:{name:n}}))}))})}onDeleteTopic(){return m(this,null,function*(){let e=this.currentTopic();if(!e||this.requests().length>0)return;let{ConfirmDialogComponent:t}=yield import("./chunk-MAEIQDBH.js");this.dialog.open(t,{data:{title:"Delete Topic",message:"Are you sure you want to delete this topic?",confirmText:"Delete"}}).afterClosed().subscribe(n=>m(this,null,function*(){if(!n)return;let{removeTopic:s}=yield import("./chunk-OVHPNYRZ.js");this.store.dispatch(s({id:e.id})),this.back()}))})}onEditRequest(e){return m(this,null,function*(){let t=this.allRequests().find(i=>i.id===e);t&&this.editingRequestId!==e&&(this.editingRequestId=e,this.editingRequestText=t.description,this.editingExisting=!0)})}saveInline(e){return m(this,null,function*(){let t=(this.editingRequestText||"").trim();if(!t)return;let i={description:t};this.store.dispatch(v({id:e,changes:i})),this.editingRequestId=null,this.editingRequestText="",this.editingExisting=!1})}cancelInline(){return m(this,null,function*(){let e=this.editingRequestId;if(e==null)return;let t=this.allRequests().find(i=>i.id===e);(!t||!t.description?.trim())&&(yield this.onRemove(e)),this.editingRequestId=null,this.editingRequestText="",this.editingExisting=!1})}onInlineDelete(){return m(this,null,function*(){let e=this.editingRequestId;e!=null&&(yield this.onRemove(e),this.editingRequestId=null,this.editingRequestText="",this.editingExisting=!1)})}scrollToBottomSoon(){setTimeout(()=>{let e=this.requestsContainer?.nativeElement;e&&(e.scrollTop=e.scrollHeight)},0)}markAnsweredInline(e){return m(this,null,function*(){let t=(this.editingRequestText||"").trim();if(!t)return;let i={description:t,answeredDate:new Date().toISOString()};this.store.dispatch(v({id:e,changes:i})),this.editingRequestId=null,this.editingRequestText="",this.editingExisting=!1})}static \u0275fac=function(t){return new(t||o)};static \u0275cmp=q({type:o,selectors:[["ng-component"]],viewQuery:function(t,i){if(t&1&&R(tt,5),t&2){let n;M(n=E())&&(i.requestsContainer=n.first)}},decls:12,vars:4,consts:[["requestsContainer",""],[1,"section-bar"],[1,"title-stack",3,"click"],[1,"section-title"],["type","text","autofocus","",1,"edit-input",3,"value"],[1,"section-subtitle"],[1,"section-menu"],[1,"requests"],["mat-fab","","color","primary","aria-label","Add Request",1,"fab","mat-mdc-extended-fab"],["type","text","autofocus","",1,"edit-input",3,"click","input","keydown.enter","keydown.escape","value"],["mat-icon-button","","color","warn","aria-label","Delete Topic",1,"trash-btn",3,"click","disabled"],[1,"trash"],[1,"ban"],[1,"request-card","editing"],[1,"request-card"],["rows","3","placeholder","Type your request...","autofocus","",1,"edit-textarea",3,"input","keydown.enter","value"],[1,"inline-actions"],[1,"left"],[1,"right"],["mat-button","",3,"click"],["mat-flat-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","primary",3,"click","disabled"],["mat-stroked-button","","color","warn",3,"click"],[1,"request-card",3,"click"],[1,"request-text"],[1,"request-date"],["mat-fab","","color","primary","aria-label","Add Request",1,"fab","mat-mdc-extended-fab",3,"click"]],template:function(t,i){if(t&1){let n=g();a(0,"section")(1,"div",1)(2,"div",2),_("click",function(){return d(n),p(i.startEdit())}),f(3,it,2,1,"h3",3)(4,nt,1,1,"input",4),f(5,ot,2,1,"div",5),c(),f(6,st,5,2,"div",6),c(),a(7,"div",7,0),w(9,dt,2,1,null,null,et),c(),f(11,pt,4,0,"button",8),c()}if(t&2){let n;l(3),x(i.editing?4:3),l(2),x((n=i.currentList())?5:-1,n),l(),x(i.editing?6:-1),l(3),k(i.requests()),l(2),x(!i.editing&&i.editingRequestId===null?11:-1)}},dependencies:[O,N,F,$,z,L,B,j,P],styles:["section[_ngcontent-%COMP%]{position:relative;height:calc(100vh - 5rem);display:flex;flex-direction:column}.section-title[_ngcontent-%COMP%]{margin:0 0 .5rem;color:var(--md-sys-color-on-surface, #4e342e)}.section-bar[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;position:relative;background-color:var(--app-color-primary-darker)!important;gap:12px;padding:1rem}.title-stack[_ngcontent-%COMP%]{display:flex;flex-direction:column;cursor:text}.section-subtitle[_ngcontent-%COMP%]{font-size:12px;color:#ffffffb3;margin-top:-4px}.requests[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:12px;padding:1rem 1rem 5rem;flex:1 1 auto;overflow-y:auto}.request-card[_ngcontent-%COMP%]{border-radius:12px;padding:12px 14px;background:var(--md-sys-color-primary);color:var(--md-sys-color-on-primary);box-shadow:0 1px 4px #3e272333}.request-text[_ngcontent-%COMP%]{white-space:pre-wrap;line-height:1.4;font-size:.95rem}.request-date[_ngcontent-%COMP%]{margin-top:6px;font-size:12px;color:#ffffffb3;text-align:right}.section-menu[_ngcontent-%COMP%]{position:absolute;right:.5rem}.trash-btn[_ngcontent-%COMP%]{position:relative}.trash-btn[disabled][_ngcontent-%COMP%]   .trash[_ngcontent-%COMP%]{opacity:.4}.trash-btn[_ngcontent-%COMP%]   .ban[_ngcontent-%COMP%]{position:absolute;inset:-2px -2px auto auto;color:#ffffffd9;font-size:20px}.request-card.editing[_ngcontent-%COMP%]{background:var(--md-sys-color-primary-container);color:var(--md-sys-color-on-primary-container);padding:10px}.edit-textarea[_ngcontent-%COMP%]{width:100%;box-sizing:border-box;background:#0000000d;color:var(--md-sys-color-on-primary-container);border:1px solid rgba(0,0,0,.25);border-radius:8px;padding:8px 10px;resize:vertical}.inline-actions[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;gap:8px;margin-top:8px}.inline-actions[_ngcontent-%COMP%]   .left[_ngcontent-%COMP%]{display:flex;align-items:center;gap:8px}.inline-actions[_ngcontent-%COMP%]   .right[_ngcontent-%COMP%]{display:flex;gap:8px}.edit-input[_ngcontent-%COMP%]{width:100%;background:transparent;border:none;outline:none;color:var(--md-sys-color-on-primary);font:inherit;padding:.25rem .5rem;border-radius:6px;box-shadow:inset 0 -1px #ffffff4d}.edit-input[_ngcontent-%COMP%]::placeholder{color:#ffffffb3}.fab[_ngcontent-%COMP%]{position:fixed;bottom:24px;right:24px;z-index:100;--mdc-extended-fab-container-color: var(--md-sys-color-primary-container);--mdc-fab-container-color: var(--md-sys-color-primary-container);--mdc-extended-fab-label-text-color: var(--md-sys-color-on-primary);--mdc-fab-foreground-color: var(--md-sys-color-on-primary);--mat-fab-foreground-color: var(--md-sys-color-on-primary);background-color:var(--md-sys-color-primary-container)!important;color:var(--md-sys-color-on-primary)!important}"]})};export{Z as TopicComponent};
